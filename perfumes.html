<!DOCTYPE html>
<html>
<head>
    <title>View perfumes</title>
    <!-- Include jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
</head>
<body>
    <h1>Perfumes</h1>
    <!-- Button to show the form for creating a new perfume -->
    <div><button id="button-showCreate" onclick="showCreate()">Create a perfume</button><br/><br/></div>
    <div>
        <!-- Table to display the list of perfumes -->
        <table border="1" id="perfumeTable">
            <tr>
                <!-- Table header columns -->
                <th>id</th>
                <th>Name</th>
                <th>Brand</th>
                <th>Size (ml)</th>
                <th>Price (EUR)</th>
                <th>Gender</th>
                <th>Update</th>
                <th>Delete</th>
            </tr>
        </table>
        <br/>
    </div>
    <!-- Form for creating or updating a perfume -->
    <div id="createUpdateForm" style="display:none">
        <h2><span id="createLabel">Create a</span> Perfume</h2>

        <!-- Hidden input field for storing the ID of the perfume -->
        <input type="hidden" name="id">

        <!-- Input fields for entering perfume details -->
        Name <input type="text" name="name"><br/>
        Brand <input type="text" name="brand"><br/>
        Size (ml) <input type="number" name="size_ml"><br/>
        Price (EUR) <input type="number" name="price_eur"><br/>
        Gender <input type="text" name="gender"><br/>
        <!-- Button for creating a new perfume -->
        <span><button id="button-doCreate" onclick="doCreate()">Create</button></span>
        <!-- Button for updating an existing perfume -->
        <span><button id="button-doUpdate" onclick="doUpdate()" style="display:none;">Update</button></span>

    </div>

    <script>
        $(document).ready(function() {
            // Function to load all perfumes from the server and display them in the table
            $.get("/perfumes", function(data) {
                data.forEach(function(perfume) {
                    addPerfumeToTable(perfume);
                });
            });
        });

        // Function to show the form for creating a new perfume
        function showCreate() {
            var form = document.getElementById("createUpdateForm");
            if (form) {
                // Show the form and hide unnecessary elements
                form.style.display = "block";
                document.getElementById("button-doCreate").style.display = "block";
                document.getElementById("button-doUpdate").style.display = "none";
                document.getElementById("createLabel").style.display = "inline";
                document.getElementById("button-showCreate").style.display = "none";
                document.getElementById("perfumeTable").style.display = "none";
            } else {
                console.log("Error: createUpdateForm not found");
            }
        }

        // Function to show the form for updating an existing perfume
        function showUpdate(buttonElement){
            var form = document.getElementById("createUpdateForm");
            form.style.display = "block";
            document.getElementById("button-doCreate").style.display = "none";
            document.getElementById("button-doUpdate").style.display = "block";
            document.getElementById("createLabel").style.display = "none";
            document.getElementById("button-showCreate").style.display = "none";
            document.getElementById("perfumeTable").style.display = "none";

            // Get the details of the selected perfume and populate the form fields
            var rowElement = buttonElement.parentNode.parentNode;
            var perfume = getPerfumeFromRow(rowElement);
            populateFormWithPerfume(perfume);
        }

        // Function to hide the form and display the table
        function showViewall(){
            document.getElementById("createUpdateForm").style.display = "none";
            document.getElementById("button-showCreate").style.display = "block";
            document.getElementById("perfumeTable").style.display = "block";
        }

        // Function to clear the input fields of the form
        function clearForm(){
            var form = document.getElementById('createUpdateForm');
            form.querySelector('input[name="id"]').value = '';
            form.querySelector('input[name="name"]').value = '';
            form.querySelector('input[name="brand"]').value = '';
            form.querySelector('input[name="size_ml"]').value = '';
            form.querySelector('input[name="price_eur"]').value = '';
            form.querySelector('input[name="gender"]').value = '';
        }

        // Function to extract perfume details from the form
        function getPerfumeFromForm() {
            var form = document.getElementById('createUpdateForm');
            var perfume = {};
            perfume.id = form.querySelector('input[name="id"]').value;
            perfume.Name = form.querySelector('input[name="name"]').value;
            perfume.Brand = form.querySelector('input[name="brand"]').value;
            perfume.Size_ml = form.querySelector('input[name="size_ml"]').value;
            perfume.Price_eur = form.querySelector('input[name="price_eur"]').value;
            perfume.Gender = form.querySelector('input[name="gender"]').value;
            return perfume;
        }

        // Function to populate the form fields with perfume details
        function populateFormWithPerfume(perfume) {
            var form = document.getElementById('createUpdateForm');
            form.querySelector('input[name="id"]').value = perfume.id;
            form.querySelector('input[name="name"]').value = perfume.Name;
            form.querySelector('input[name="brand"]').value = perfume.Brand;
            form.querySelector('input[name="size_ml"]').value = perfume.Size_ml;
            form.querySelector('input[name="price_eur"]').value = perfume.Price_eur;
            form.querySelector('input[name="gender"]').value = perfume.Gender;
        }

    </script>
</body>
</html>